<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dirigo Sea Farm Cost Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.8.0/umd/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend } = Recharts;

        const CostDashboard = () => {
          // Three key levers (yellow variables)
          const [seaweedPrice, setSeaweedPrice] = useState(8.00);
          const [alginateYield, setAlginateYield] = useState(12);
          const [ethanolRecovery, setEthanolRecovery] = useState(0); // % recovery affects ethanol cost

          // Base constants
          const baseEthanolPrice = 71.98;
          const baseKelpQuantity = 6;
          const sodiumBicarbPrice = 1.00;
          const sodiumBicarbQuantity = 1.98;
          const ethanolQuantity = 0.462301;
          const glycerolPrice = 1.03;
          const glycerolUtilization = 0.6;

          // Calculate all values directly in render
          const effectiveEthanolPrice = baseEthanolPrice * (1 - ethanolRecovery / 100);
          const ethanolCost = ethanolQuantity * effectiveEthanolPrice;
          const kelpCost = baseKelpQuantity * seaweedPrice;
          const sodiumBicarbCost = sodiumBicarbQuantity * sodiumBicarbPrice;
          const alginateLbs = baseKelpQuantity * (alginateYield / 100);
          const totalRawMaterialCost = kelpCost + sodiumBicarbCost + ethanolCost;
          const sodiumAlginatePerLb = totalRawMaterialCost / alginateLbs;
          const sodiumAlginatePerKg = sodiumAlginatePerLb * 2.20462;
          const glycerolCost = glycerolUtilization * glycerolPrice;
          const sodiumAlginateForFilm = 0.4 * sodiumAlginatePerKg;
          const filmCostPerKg = glycerolCost + sodiumAlginateForFilm;
          const filmCostPerLb = filmCostPerKg / 2.20462;
          const biomassLbs = baseKelpQuantity - alginateLbs;

          // Chart data for cost breakdown
          const costBreakdownData = [
            {
              name: 'Kelp',
              cost: kelpCost,
              baseline: 48.00
            },
            {
              name: 'Sodium Bicarb',
              cost: sodiumBicarbCost,
              baseline: 1.98
            },
            {
              name: 'Ethanol',
              cost: ethanolCost,
              baseline: 33.28
            }
          ];

          const outputData = [
            {
              name: 'Sodium Alginate ($/Kg)',
              current: sodiumAlginatePerKg,
              baseline: 254.93,
              target: 15.00
            },
            {
              name: 'Film Cost ($/Lb)',
              current: filmCostPerLb,
              baseline: 46.54,
              target: 15.00
            }
          ];

          // Calculate percentage changes
          const alginateChange = ((sodiumAlginatePerKg - 254.93) / 254.93 * 100).toFixed(1);
          const filmChange = ((filmCostPerLb - 46.54) / 46.54 * 100).toFixed(1);

          return (
            <div className="p-6 max-w-7xl mx-auto bg-gray-50 min-h-screen">
              <div className="mb-8">
                <h1 className="text-3xl font-bold text-gray-900 mb-2">Dirigo Sea Farm Cost Analysis Dashboard</h1>
                <p className="text-gray-600">Adjust the three key levers to optimize production costs</p>
              </div>

              {/* Control Panel */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                {/* Seaweed Price */}
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">üåø Seaweed Price</h3>
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Price per Lb: ${seaweedPrice.toFixed(2)}
                    </label>
                    <input
                      type="range"
                      min="2"
                      max="15"
                      step="0.25"
                      value={seaweedPrice}
                      onChange={(e) => setSeaweedPrice(parseFloat(e.target.value))}
                      className="w-full h-2 bg-yellow-200 rounded-lg appearance-none cursor-pointer"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                      <span>$2.00</span>
                      <span>$15.00</span>
                    </div>
                  </div>
                  <div className="text-sm text-gray-600">
                    Current cost: <span className="font-semibold">${kelpCost.toFixed(2)}</span>
                  </div>
                </div>

                {/* Alginate Yield */}
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">‚öóÔ∏è Alginate Yield</h3>
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Yield: {alginateYield}%
                    </label>
                    <input
                      type="range"
                      min="5"
                      max="25"
                      step="0.5"
                      value={alginateYield}
                      onChange={(e) => setAlginateYield(parseFloat(e.target.value))}
                      className="w-full h-2 bg-yellow-200 rounded-lg appearance-none cursor-pointer"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                      <span>5%</span>
                      <span>25%</span>
                    </div>
                  </div>
                  <div className="text-sm text-gray-600">
                    Alginate output: <span className="font-semibold">{alginateLbs.toFixed(2)} lbs</span>
                  </div>
                </div>

                {/* Ethanol Recovery */}
                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">üîÑ Ethanol Recovery</h3>
                  <div className="mb-4">
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Recovery Rate: {ethanolRecovery}%
                    </label>
                    <input
                      type="range"
                      min="0"
                      max="95"
                      step="5"
                      value={ethanolRecovery}
                      onChange={(e) => setEthanolRecovery(parseFloat(e.target.value))}
                      className="w-full h-2 bg-yellow-200 rounded-lg appearance-none cursor-pointer"
                    />
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                      <span>0%</span>
                      <span>95%</span>
                    </div>
                  </div>
                  <div className="text-sm text-gray-600">
                    Effective price: <span className="font-semibold">${effectiveEthanolPrice.toFixed(2)}/gal</span>
                  </div>
                </div>
              </div>

              {/* Key Metrics */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">üí∞ Sodium Alginate Cost</h3>
                  <div className="text-3xl font-bold text-blue-600 mb-2">
                    ${sodiumAlginatePerKg.toFixed(2)}/Kg
                  </div>
                  <div className="flex items-center">
                    <span className={`text-sm font-medium ${parseFloat(alginateChange) < 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {parseFloat(alginateChange) > 0 ? '+' : ''}{alginateChange}% vs baseline
                    </span>
                  </div>
                  <div className="mt-2 text-sm text-gray-600">
                    Baseline: $254.93/Kg | Target: $15.00/Kg (food-grade market price)
                  </div>
                </div>

                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-xl font-semibold text-gray-900 mb-4">üé¨ Film Production Cost</h3>
                  <div className="text-3xl font-bold text-green-600 mb-2">
                    ${filmCostPerLb.toFixed(2)}/Lb
                  </div>
                  <div className="flex items-center">
                    <span className={`text-sm font-medium ${parseFloat(filmChange) < 0 ? 'text-green-600' : 'text-red-600'}`}>
                      {parseFloat(filmChange) > 0 ? '+' : ''}{filmChange}% vs baseline
                    </span>
                  </div>
                  <div className="mt-2 text-sm text-gray-600">
                    Baseline: $46.54/Lb | Target: $15.00/Lb
                  </div>
                </div>
              </div>

              {/* Charts */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* Raw Material Cost Breakdown */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">Raw Material Cost Breakdown</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={costBreakdownData}>
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis dataKey="name" />
                      <YAxis />
                      <Tooltip formatter={(value) => [`$${value.toFixed(2)}`, 'Cost']} />
                      <Bar dataKey="cost" fill="#3B82F6" name="Current" />
                      <Bar dataKey="baseline" fill="#E5E7EB" name="Baseline" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>

                {/* Output Costs Comparison */}
                <div className="bg-white rounded-lg shadow-md p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">Output Costs vs Targets</h3>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={outputData} layout="vertical">
                      <CartesianGrid strokeDasharray="3 3" />
                      <XAxis type="number" />
                      <YAxis dataKey="name" type="category" width={120} />
                      <Tooltip formatter={(value) => [`$${value.toFixed(2)}`, '']} />
                      <Legend />
                      <Bar dataKey="current" fill="#10B981" name="Current" />
                      <Bar dataKey="baseline" fill="#6B7280" name="Baseline" />
                      <Bar dataKey="target" fill="#F59E0B" name="Target" />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* Summary Table */}
              <div className="mt-8 bg-white rounded-lg shadow-md p-6">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">Cost Analysis Summary</h3>
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Component</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Current Value</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Baseline</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Change</th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      <tr className="bg-yellow-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Seaweed Price ($/Lb)</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${seaweedPrice.toFixed(2)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$8.00</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{((seaweedPrice - 8) / 8 * 100).toFixed(1)}%</td>
                      </tr>
                      <tr className="bg-yellow-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Alginate Yield (%)</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{alginateYield}%</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">12%</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{((alginateYield - 12) / 12 * 100).toFixed(1)}%</td>
                      </tr>
                      <tr className="bg-yellow-50">
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Ethanol Recovery (%)</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{ethanolRecovery}%</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">0%</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">+{ethanolRecovery}%</td>
                      </tr>
                      <tr>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Sodium Alginate ($/Kg)</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${sodiumAlginatePerKg.toFixed(2)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$254.93</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{alginateChange}%</td>
                      </tr>
                      <tr>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Film Cost ($/Lb)</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${filmCostPerLb.toFixed(2)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">$46.54</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{filmChange}%</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<CostDashboard />, document.getElementById('root'));
    </script>
</body>
</html>